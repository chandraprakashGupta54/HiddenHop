<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiddenHop - Nearby Places</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/public/style.css">
    <style>
        :root {
            --primary-color: #4f46e5;
            --secondary-color: #06b6d4;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-color: #1f2937;
            --light-color: #f8fafc;
            --gradient-bg: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-top: 2rem;
        }

      
    </style>
</head>
<body>
        <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <a href="index.html">üöÇ HiddenHop</a>
            </div>
            <div class="nav-menu" id="navMenu">
                <a href="index.html" class="nav-link active">Home</a>
                <a href="favorites.html" class="nav-link">
                    Favorites <span class="fav-count" id="favCount">0</span>
                </a>
                <a href="about.html" class="nav-link">About</a>
                <a href="contact.html" class="nav-link">Contact</a>
            </div>
            <div class="nav-auth" id="navauth">
                <a href="login.html" class="btn btn-primary">Login</a>
                <a href="signup.html" class="btn btn-primary">Sign Up</a>
            </div>
            <div class="hamburger" id="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="main-container">
            <!-- Header Section -->
            <div class="header-section">
                <h1><i class="fas fa-map-marker-alt"></i> HiddenHop</h1>
                <p>Discover amazing places near your location</p>
                <div class="location-controls">
                    <button class="btn btn-light btn-custom" onclick="getCurrentLocation()">
                        <i class="fas fa-crosshairs"></i> Use My Location
                    </button>
                    <button class="btn btn-outline-light btn-custom" onclick="showLocationInput()">
                        <i class="fas fa-search"></i> Search Location
                    </button>
                </div>
                <div id="locationInput" style="display: none; margin-top: 1rem;">
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control" id="locationSearch" 
                                       placeholder="Enter city, address, or coordinates (lat,lng)">
                                <button class="btn btn-light" onclick="searchLocation()">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Filters Section -->
            <div class="filters-section">
                <h5 class="text-center mb-3">Filter by Category</h5>
                <div class="category-filters">
                    <button class="filter-btn active" data-category="all">All Places</button>
                    <button class="filter-btn" data-category="hospital">üè• Hospitals</button>
                    <button class="filter-btn" data-category="bank">üè¶ Banks</button>
                    <button class="filter-btn" data-category="theatre">üé≠ Theatres</button>
                    <button class="filter-btn" data-category="college">üéì Colleges</button>
                    <button class="filter-btn" data-category="restaurant">üçΩÔ∏è Restaurants</button>
                    <button class="filter-btn" data-category="fun">üéÆ Fun Activities</button>
                    <button class="filter-btn" data-category="travel">‚úàÔ∏è Travel Spots</button>
                </div>
            </div>

            <!-- Loading Section -->
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <h5>Discovering amazing places near you...</h5>
                <p class="text-muted">This may take a few seconds</p>
            </div>

            <!-- Places Container -->
            <div class="places-container">
                <div id="currentLocation" class="alert alert-info" style="display: none;">
                    <i class="fas fa-map-marker-alt"></i> 
                    <span id="locationText">Click "Use My Location" to get started</span>
                </div>
                
                <div class="places-grid" id="placesGrid">
                    <div class="no-places">
                        <i class="fas fa-map-marked-alt"></i>
                        <h4>Ready to Explore?</h4>
                        <p>Use your current location or search for a place to discover amazing spots nearby!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
        <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>HiddenHop</h3>
                    <p>Your ultimate guide to discovering places around Mumbai's railway stations.</p>
                
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="index.html">Home</a>
                    <a href="favorites.html">Favorites</a>
                    <a href="about.html">About</a>
                </div>
                <div class="footer-section">
                    <h4>Categories</h4>
                    <a href="places.html?category=hospitals">Hospitals</a>
                    <a href="places.html?category=restaurants">Restaurants</a>
                    <a href="places.html?category=theatres">Theatres</a>
                    <a href="places.html?category=travel">Travel Spots</a>
                </div>
                <div class="footer-section">
                    <h4>Support</h4>
                    <a href="contact.html">Contact Us</a>
                    <a href="#" class="footer-link">Privacy Policy</a>
                    <a href="#" class="footer-link">Terms of Service</a>
                    <a href="#" class="footer-link">Help Center</a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 HiddenHop. All rights reserved.</p>
            </div>
        </div>
    </footer>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Global variables
        let currentLat = null;
        let currentLng = null;
        let allPlaces = [];
        let activeFilter = 'all';

        // Unsplash Access Key (Demo key - replace with your own)
        const UNSPLASH_ACCESS_KEY = 'your-unsplash-access-key-here';

        // Category mappings for Overpass API
        const categoryMappings = {
            hospital: {
                query: 'amenity=hospital',
                fallbackImage: 'hospital medical healthcare',
                icon: 'üè•',
                description: 'Healthcare facility providing medical services'
            },
            bank: {
                query: 'amenity=bank',
                fallbackImage: 'bank finance building',
                icon: 'üè¶',
                description: 'Financial institution for banking services'
            },
            theatre: {
                query: 'amenity=theatre',
                fallbackImage: 'theatre theater performance',
                icon: 'üé≠',
                description: 'Entertainment venue for performances'
            },
            college: {
                query: 'amenity=college',
                fallbackImage: 'college university education',
                icon: 'üéì',
                description: 'Educational institution for higher learning'
            },
            restaurant: {
                query: 'amenity=restaurant',
                fallbackImage: 'restaurant food dining',
                icon: 'üçΩÔ∏è',
                description: 'Dining establishment serving meals'
            },
            fun: {
                query: 'leisure=park',
                fallbackImage: 'park recreation fun activities',
                icon: 'üéÆ',
                description: 'Recreational area for leisure activities'
            },
            travel: {
                query: 'tourism=attraction',
                fallbackImage: 'tourist attraction travel',
                icon: '‚úàÔ∏è',
                description: 'Popular destination for tourists'
            }
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeFilters();
        });

        function initializeFilters() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    activeFilter = this.dataset.category;
                    filterPlaces();
                });
            });
        }

        function showLocationInput() {
            const locationInput = document.getElementById('locationInput');
            locationInput.style.display = locationInput.style.display === 'none' ? 'block' : 'none';
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                alert('Geolocation is not supported by this browser');
                return;
            }

            showLoading(true);
            navigator.geolocation.getCurrentPosition(
                position => {
                    currentLat = position.coords.latitude;
                    currentLng = position.coords.longitude;
                    updateLocationDisplay(`${currentLat.toFixed(4)}, ${currentLng.toFixed(4)}`);
                    fetchNearbyPlaces();
                },
                error => {
                    showLoading(false);
                    alert('Error getting location: ' + error.message);
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 300000
                }
            );
        }

        function searchLocation() {
            const searchInput = document.getElementById('locationSearch');
            const query = searchInput.value.trim();
            
            if (!query) {
                alert('Please enter a location');
                return;
            }

            showLoading(true);

            // Check if input is coordinates (lat,lng format)
            const coordMatch = query.match(/^(-?\d+\.?\d*),\s*(-?\d+\.?\d*)$/);
            if (coordMatch) {
                currentLat = parseFloat(coordMatch[1]);
                currentLng = parseFloat(coordMatch[2]);
                updateLocationDisplay(query);
                fetchNearbyPlaces();
                return;
            }

            // Use Nominatim API for geocoding
            fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=1`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        currentLat = parseFloat(data[0].lat);
                        currentLng = parseFloat(data[0].lon);
                        updateLocationDisplay(data[0].display_name);
                        fetchNearbyPlaces();
                    } else {
                        showLoading(false);
                        alert('Location not found. Please try a different search term.');
                    }
                })
                .catch(error => {
                    showLoading(false);
                    alert('Error searching location: ' + error.message);
                });
        }

        function updateLocationDisplay(locationText) {
            const locationDiv = document.getElementById('currentLocation');
            const locationTextSpan = document.getElementById('locationText');
            locationTextSpan.textContent = `Current location: ${locationText}`;
            locationDiv.style.display = 'block';
        }

        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            spinner.style.display = show ? 'block' : 'none';
        }

        async function fetchNearbyPlaces() {
            if (!currentLat || !currentLng) return;

            showLoading(true);
            allPlaces = [];

            try {
                // Fetch places for each category
                const promises = Object.entries(categoryMappings).map(([category, config]) => 
                    fetchPlacesForCategory(category, config)
                );

                const results = await Promise.all(promises);
                allPlaces = results.flat().filter(place => place !== null);
                
                // Sort by distance
                allPlaces.sort((a, b) => a.distance - b.distance);
                
                showLoading(false);
                displayPlaces(allPlaces);
            } catch (error) {
                showLoading(false);
                console.error('Error fetching places:', error);
                showNoPlaces('Error loading places. Please try again.');
            }
        }

        async function fetchPlacesForCategory(category, config) {
            const radius = 5000; // 5km radius
            const overpassQuery = `
                [out:json][timeout:25];
                (
                  node[${config.query}](around:${radius},${currentLat},${currentLng});
                  way[${config.query}](around:${radius},${currentLat},${currentLng});
                  relation[${config.query}](around:${radius},${currentLat},${currentLng});
                );
                out center tags;
            `;

            try {
                const response = await fetch('https://overpass-api.de/api/interpreter', {
                    method: 'POST',
                    body: overpassQuery,
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    }
                });

                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                
                const data = await response.json();
                
                return data.elements.map(element => {
                    const lat = element.lat || (element.center && element.center.lat);
                    const lng = element.lon || (element.center && element.center.lon);
                    
                    if (!lat || !lng) return null;

                    const distance = calculateDistance(currentLat, currentLng, lat, lng);
                    
                    return {
                        id: element.id,
                        name: element.tags?.name || 'Unknown Place',
                        category: category,
                        categoryIcon: config.icon,
                        lat: lat,
                        lng: lng,
                        distance: distance,
                        address: formatAddress(element.tags),
                        phone: element.tags?.phone || element.tags?.['contact:phone'] || ':-)',
                        website: element.tags?.website || element.tags?.['contact:website'] || ':-)',
                        email: element.tags?.email || element.tags?.['contact:email'] || ':-)',
                        description: element.tags?.description || config.description,
                        tags: element.tags,
                        image: null // Will be set later
                    };
                }).filter(place => place !== null);
            } catch (error) {
                console.error(`Error fetching ${category} places:`, error);
                return [];
            }
        }

        function formatAddress(tags) {
            if (!tags) return ':-) Address not available';
            
            const addressParts = [
                tags['addr:housenumber'],
                tags['addr:street'],
                tags['addr:city'] || tags['addr:town'] || tags['addr:village'],
                tags['addr:postcode'],
                tags['addr:country']
            ].filter(part => part);
            
            return addressParts.length > 0 ? addressParts.join(', ') : ':-) Address not available';
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Earth's radius in kilometers
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        async function getUnsplashImage(searchTerm) {
            // For demo purposes, return a placeholder since we don't have real API key
            // In production, you would use: 
            // const response = await fetch(`https://api.unsplash.com/search/photos?query=${encodeURIComponent(searchTerm)}&per_page=1&client_id=${UNSPLASH_ACCESS_KEY}`);
            
            // Return placeholder image for demo
            return `https://source.unsplash.com/400x300/?${encodeURIComponent(searchTerm)}`;
        }

        function filterPlaces() {
            const filteredPlaces = activeFilter === 'all' ? 
                allPlaces : 
                allPlaces.filter(place => place.category === activeFilter);
            displayPlaces(filteredPlaces);
        }

        async function displayPlaces(places) {
            const grid = document.getElementById('placesGrid');
            
            if (!places || places.length === 0) {
                showNoPlaces();
                return;
            }

            // Get images for all places
            for (let place of places) {
                if (!place.image) {
                    const category = categoryMappings[place.category];
                    place.image = await getUnsplashImage(category.fallbackImage);
                }
            }

            grid.innerHTML = places.map(place => `
                <div class="place-card">
                    <img src="${place.image}" alt="${place.name}" class="place-image" 
                         onerror="this.src='https://via.placeholder.com/400x200/e5e7eb/64748b?text=${encodeURIComponent(place.categoryIcon + ' ' + place.name)}'">
                    <div class="place-content">
                        <div class="place-header">
                            <div>
                                <h3 class="place-name">${place.name}</h3>
                                <span class="place-category">${place.categoryIcon} ${place.category.charAt(0).toUpperCase() + place.category.slice(1)}</span>
                            </div>
                        </div>
                        
                        <div class="place-info">
                            <div class="info-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${place.address}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-route"></i>
                                <span>${place.distance.toFixed(2)} km away</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-phone"></i>
                                <span>${place.phone}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-globe"></i>
                                <span>${place.website}</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-envelope"></i>
                                <span>${place.email}</span>
                            </div>
                        </div>
                        
                        <p class="place-description">${place.description}</p>
                        
                        <div class="place-actions">
                            <button class="btn-action btn-favorite" onclick="addToFavorites('${place.id}')">
                                <i class="fas fa-star"></i> Add to Favorites
                            </button>
                            <button class="btn-action btn-details" onclick="viewDetails('${place.id}')">
                                <i class="fas fa-info-circle"></i> View Details
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function showNoPlaces(message = '') {
            const grid = document.getElementById('placesGrid');
            const defaultMessage = activeFilter === 'all' ? 
                'No places found in this area. Try a different location or check your internet connection.' :
                `No ${activeFilter} places found in this area. Try selecting "All Places" or a different location.`;
            
            grid.innerHTML = `
                <div class="no-places">
                    <i class="fas fa-search"></i>
                    <h4>No Places Found</h4>
                    <p>${message || defaultMessage}</p>
                </div>
            `;
        }

        function addToFavorites(placeId) {
            const place = allPlaces.find(p => p.id == placeId);
            if (place) {
                // In a real app, you'd save to a database or localStorage
                alert(`Added "${place.name}" to favorites! üåü`);
            }
        }

        function viewDetails(placeId) {
            const place = allPlaces.find(p => p.id == placeId);
            if (place) {
                // In a real app, you might navigate to a details page
                const details = `
                    Place: ${place.name}
                    Category: ${place.category}
                    Distance: ${place.distance.toFixed(2)} km
                    Address: ${place.address}
                    Phone: ${place.phone}
                    Website: ${place.website}
                    Email: ${place.email}
                    
                    Coordinates: ${place.lat}, ${place.lng}
                `;
                alert(details);
            }
        }

        // Handle input events
        document.getElementById('locationSearch')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchLocation();
            }
        });
    </script>
</body>
</html>